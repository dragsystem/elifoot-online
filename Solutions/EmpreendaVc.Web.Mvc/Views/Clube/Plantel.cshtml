@model EmpreendaVc.Domain.Clube
@using EmpreendaVc.Web.Mvc.Util
@{
    ViewBag.Title = "Plantel";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
}

<h2>Plantel</h2>
@{ Html.RenderAction("Index", "Mensagem"); }

<div id="plantel-caixa">
    <table class="classificacao" cellpadding="0" cellspacing="0">
        <tr>
            <th width="35%">JOGADOR</th>
            <th width="10%">POSIÇÃO</th>
            <th width="10%">H</th>
            <th width="15%">SALÁRIO</th>
            <th width="10%">GOLS</th>
            <th width="10%">AÇÕES</th>
        </tr>
        @foreach (var jog in Model.Jogadores.OrderBy(x => x.Posicao).ThenByDescending(x => x.H))
        {
            <tr>
                <td style="text-align: left;">@jog.Nome.ToUpper()</td>
                <td>@Util.RetornaPosicao(jog.Posicao)</td>
                <td>@jog.H</td>
                <td style="text-align: right;">$@jog.Salario.ToString("N2")</td>
                <td>@jog.Gols.Count()</td>
                <td>
                    @if (jog.Contrato)
                    { <a class="plantel-sobcontrato" title="Sob-contrato" /> }
                    else
                    { <a class="plantel-semcontrato" title="Renovar contrato" href="@Url.Action("JogadorRenovar", new { id = jog.Id })" /> }
                        <a class="plantel-vender" title="Vender" href="@Url.Action("JogadorVender", new { id = jog.Id })" />
                </td>
            </tr>
        }
    </table>
</div>

<div id="plantel-dados" class="caixa">
    <h1>@Model.Nome</h1>
    <p>
        @if (Model.Usuario != null)
        {
            @:Usuário: @Model.Usuario.NomeCompleto
        }
        Estádio: @Model.Estadio.ToString("N0")<br />
        Sócios: @Model.Socios.ToString("N0")
    </p>
</div>

<div id="plantel-financas" class="caixa">
    <h1>FINANÇAS</h1>
    @{ var salarios = Model.Jogadores.Sum(x => x.Salario);
       var socios = Model.Socios * 30;
       var renda = Model.Partidas.Where(x => x.Realizada).Count() > 0 ? (Model.Partidas.Last().Publico * Model.Ingresso) : 0;
       var previsto = Model.Dinheiro + (socios + renda - salarios);
    }
    <p>
        Dinheiro em caixa: $@Model.Dinheiro.ToString("N2")
    </p>
    <p>
        Salários: $@salarios.ToString("N2")<br />
        Sócios: $@socios.ToString("N2")
    </p>
    <p>
        Renda última partida: $@renda.ToString("N2")
    </p>
    <p>
        Dinheiro em caixa previsto: $@previsto.ToString("N2")
    </p>
</div>

<div id="plantel-proximo" class="caixa">
    <h1>PRÓXIMA PARTIDA</h1>
    @if (Model.Partidas.Where(x => !x.Realizada).Count() > 0)
    {
        var partida = Model.Partidas.Where(x => !x.Realizada).First();
        <p>
            @if (partida.Clube1.Id == Model.Id)
            {
                @: @partida.Clube2.Nome (CASA)
            }
            else
            {
                @: @partida.Clube1.Nome (FORA)
            }
        </p>
        <p>
            @if (partida.Tipo == "DIVISAO")
            {
                @: @Model.Divisao.Nome (@(partida.Rodada)ª Rodada)
            }
            else if (partida.Tipo == "TACA")
            {
                @: Taça (@(partida.Mao)ª Partida)<br />
                if (partida.Mao == 2)
                {
                    var primeiramao = Model.Partidas.Where(x => x.Realizada && x.Rodada == partida.Rodada && x.Mao == 1).Last();

                    if (primeiramao != null)
                    {
                        if (primeiramao.Clube1.Id == Model.Id)
                        {
                            @: 1º partida: @primeiramao.Gol1 x @primeiramao.Gol2
                        }
                        else
                        {
                            @: 1º partida: @primeiramao.Gol2 x @primeiramao.Gol1
                        }
                    }
                }
            }
        </p>
    }
</div>

<div id="plantel-classificacao">
    @{ Html.RenderAction("ClassificacaoClube", new { iddivisao = Model.Divisao.Id }); }

</div>

