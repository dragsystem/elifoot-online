@model EmpreendaVc.Domain.Jogador
@using EmpreendaVc.Web.Mvc.Util
@using MvcContrib
@using MvcContrib.FluentHtml
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var controle = (EmpreendaVc.Domain.Controle)ViewBag.Controle;
    var clube = (EmpreendaVc.Domain.Clube)ViewBag.Clube; 
}
<script type="text/javascript">
    var idelemento = '';

    $(function () {
        $("#Situacao").change(function () {
            situacao($(this).val());
        });
    });

    function situacao(situacao) {
        $.ajax({
            type: "GET",
            url: '@Url.Action("AlteraSituacao", "Jogador")',
            data: { id: @Model.Id, situacao: situacao },
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                if (result != "ok") {
                    alert('Erro ao tentar mudar a situação do jogador.');
                }
            }
        });
    }
</script>

<h2>@Model.Nome @(Model.Clube != null ? "(" + Model.Clube.Nome + ")" : "")</h2>
@{ Html.RenderAction("Index", "Mensagem"); }

<div id="left">
    @if (Model.Temporario)
    {
        <p>Este jogador pertence as categorias de base e está suprindo a falta de jogadores da posição. Assim que houver jogadores ele retornará as categorias de base.</p>
    }
    <div id="jogador-tabela">
        <table class="classificacao" cellpadding="0" cellspacing="0">
            <tr>
                <th width="25%">Posição</th>
                <th width="25%">H</th>
                <th width="25%">Contrato</th>
                <th width="25%">Salário</th>
            </tr>
            <tr>
                <td>@Util.RetornaPosicaoCompleta(Model.Posicao)</td>
                @if (Model.Clube != null && !Model.Temporario)
                {
                    <td>@Model.H</td>
                    <td>$@Model.Salario.ToString("N2")</td>
                    <td>@Model.Contrato ano(s)</td>
                }
                else if (Model.Clube != null && !Model.Temporario)
                {
                    <td colspan="2">Categorias de Base</td>
                }
                else
                {
                    <td>-</td>
                    <td>-</td>
                }
            </tr>
        </table>
    </div>
    @if (Model.Clube != null && !Model.Temporario)
    {
        <div id="jogador-situacao">
            <p>
                Situação do jogador no plantel:
                @if (Model.Clube.Id == clube.Id)
                {
                    @this.Select("Situacao").Options(Util.RetornaListaSituacao()).Selected(Model.Situacao > 0 ? Model.Situacao.ToString() : "").Styles(@width => "477px;")
                }
                else
                {
                    @: @Util.RetornaSituacao(Model.Situacao)
                }
            </p>
        </div>
    }
    <h3>Histórico</h3>
    <div id="jogador-historico">
        <table class="classificacao" cellpadding="0" cellspacing="0">
            <tr>
                <th width="10%">Ano</th>
                <th width="40%">Clube</th>
                <th width="20%"></th>
                <th width="15%">Jogos</th>
                <th width="15%">Gols</th>
            </tr>
            @if (Model.Clube != null)
            {
                <tr>
                    <td>@controle.Ano</td>
                    <td>@Model.Clube.Nome</td>
                    <td></td>
                    <td>@Model.Jogos</td>
                    <td>@Model.Gols.Where(x => x.Clube.Id == Model.Clube.Id).Count()</td>
                </tr>
            }
            @foreach (var historico in Model.Historico.OrderByDescending(x => x.Ano).ThenByDescending(x => x.Data))
            {
                <tr>
                    <td>@historico.Ano</td>
                    <td>@historico.Clube.Nome</td>
                    <td>@(historico.Valor > 0 ? "$" + historico.Valor.ToString("N2") : "$0,00")</td>
                    <td>@historico.Jogos</td>
                    <td>@historico.Gols</td>
                    @*<td>@(historico.NotaMedia > 0 ? historico.NotaMedia.ToString("N2") : "0,00")</td>*@
                </tr>
            }
        </table>
    </div>
</div>

<div id="right">
    <div id="jogador-lista" style="width: 280px;">
        <table class="classificacao" cellpadding="0" cellspacing="0">
            <tr>
                <th colspan="2">Condição Física</th>
            </tr>
            <tr>
                @if (Model.Lesionado > 0)
                {
                    <td width="80%" style="text-align: left;">Lesionado até @(DateTime.Now.AddDays(Model.Lesionado).ToShortDateString())</td>
                    <td width="20%">-</td>
                }
                else
                {
                    <td width="80%" style="text-align: left;">@Util.RetornaCondicao(Model.Condicao)</td>
                    <td width="20%">@Model.Condicao %</td>
                }                
            </tr>
        </table>
    </div>
    @{ Html.RenderAction("_MenuJogador", "Jogador", new { id = Model.Id }); }
</div>

<a class="voltar-link" href="javascript:history.back()">VOLTAR</a>
