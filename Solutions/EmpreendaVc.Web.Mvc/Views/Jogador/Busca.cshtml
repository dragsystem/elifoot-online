@model EmpreendaVc.Web.Mvc.Controllers.ViewModels.JogadorFiltroView
@using EmpreendaVc.Web.Mvc.Util
@using MvcContrib
@using MvcContrib.FluentHtml
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var clube = (EmpreendaVc.Domain.Clube)ViewBag.Clube;
    var lst = (IList<EmpreendaVc.Domain.Jogador>)ViewBag.Resultado;
    var page = (int)ViewBag.Page;
    var olheiro = (bool)ViewBag.Olheiro;
}
<h2>
    Buscar</h2>
@{ Html.RenderAction("Index", "Mensagem"); }

@if (olheiro)
{
    using (Html.BeginForm())
    {
        Html.AntiForgeryToken();
        <div id="busca-filtro">
            Nome: @Html.TextBoxFor(x => x.Nome, new { size = 50 })
            Posição: @this.Select("Posicao").Options(Util.RetornaListaPosicao()).FirstOption("TODAS").Selected(Model.Posicao != 0 ? Model.Posicao.ToString() : "")
            Contrato: @this.Select("Contrato").Options(Util.RetornaListaContrato()).FirstOption("TODOS").Selected(Model.Contrato != 0 ? Model.Contrato.ToString() : "")<br />
            Situação: @this.Select("Situacao").Options(Util.RetornaSituacao()).FirstOption("TODAS").Selected(Model.Situacao != 0 ? Model.Situacao.ToString() : "") 
            Ordenar por: @this.Select("Ordenacao").Options(Util.RetornaListaOrdenacao()).Selected(Model.Ordenacao != 0 ? Model.Ordenacao.ToString() : "1")<br /><br />
            <input type="submit" class="submit" value="Buscar" />
        </div>
    }
}

<div id="left">
    <div id="jogador-tabela">
        <table class="classificacao" cellpadding="0" cellspacing="0">
            <tr>
                <th width="30%">JOGADOR</th>
                <th width="25%">CLUBE</th>
                <th width="10%">POSIÇÃO</th>
                <th width="15%">NOTA MÉDIA</th>
                <th width="10%">JOGOS</th>
                <th width="10%">GOLS</th>
            </tr>
            @if (olheiro)
            {
                if (lst.Count() > 0)
                {
                    foreach (var item in lst)
                    {
                        <tr>
                            <td style="text-align: left;"><a href="@Url.Action("Index", "Jogador", new { id = item.Id })">@item.Nome.ToUpper()</a></td>
                            <td>@(item.Clube != null ? item.Clube.Nome : "-")</td>
                            <td>@Util.RetornaPosicao(item.Posicao)</td>
                            <td>@(item.NotaMedia > 0 ? item.NotaMedia.ToString("N2") : "0,00")</td>
                            <td>@(item.Clube != null ? item.Jogos.ToString() : "-")</td>
                            <td>@(item.Clube != null ? item.Gols.Where(x => x.Clube.Id == item.Clube.Id).Count().ToString() : "-")</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6"><i>Nenhum jogador listado.</i></td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="6"><i>Você precisa <a href="@Url.Action("Busca", "Staff")">CONTRATAR</a> um olheiro para buscar jogadores.</i></td>
                </tr>
            }
        </table>
        @if (page > 1)
        {
            <a href="@Url.Action("Busca", "Jogador", new { p = (page - 1) })">Página anterior</a> 
            @:-
        }
        @if (lst.Count() == 40)
        {
            <a href="@Url.Action("Busca", "Jogador", new { p = (page + 1) })">Próxima página</a>
        }
    </div>
</div>

<div id="right">
    <div id="jogador-lista" class="caixa">
        <h1>
            Opções</h1>
        <a><b>Buscar</b></a><br />
        <a href="@Url.Action("MinhasPropostas", "Jogador")" >Minhas Propostas</a><br />
        <a href="@Url.Action("MeusJogadores", "Jogador")">Propostas Recebidas</a><br />
    </div>
    @{ Html.RenderAction("_Menu", "Clube"); }
</div>
