@model IEnumerable<EmpreendaVc.Domain.Partida>
@using EmpreendaVc.Web.Mvc.Util
@{
    ViewBag.Title = "Plantel";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var lstdivisao = (List<EmpreendaVc.Domain.Divisao>)ViewBag.lstDivisao;
    var clube = (EmpreendaVc.Domain.Clube)ViewBag.Clube;
    var competicao = ViewBag.Competicao.ToString();
    var divisao = (int)ViewBag.Divisao;
    var rodada = ViewBag.Rodada.ToString();
    var rodadanum = (int)ViewBag.RodadaNum;
    var mao = ViewBag.Mao != null ? (int)ViewBag.Mao : 0;

    var lstpartidas = divisao == 0 ? Model.Where(x => x.Mao == mao) : Model;
    
}
<h2>@competicao - @rodada</h2>
<div id="resultados-lista" class="caixa">
    <h1>
        Competições</h1>
    @if (divisao == 0)
    {
        <a><b>TAÇA</b></a><br />
    }
    else
    {
        <a href="@Url.Action("Resultados", "Clube", new { taca = 1 })">TAÇA</a><br />
    }
    @foreach (var div in lstdivisao)
    {
        if (div.Id == divisao)
        {
        <a><b>@div.Nome</b></a><br />
        }
        else
        {
        <a href="@Url.Action("Resultados", "Clube", new { divisao = div.Id })" >@div.Nome</a><br />
        }
    }
</div>
<div id="resultados-tabela">
    @if (lstpartidas.Count() > 0)
    {
        <table class="resultado" cellpadding="0" cellspacing="0">
            <tr>
                <th style="text-align: right;" width="30%">
                    CLUBE (CASA)
                </th>
                <th style="text-align: right;" width="10%">
                </th>
                <th width="5%">
                </th>
                <th style="text-align: left;" width="10%">
                </th>
                <th style="text-align: left;" width="30%">
                    CLUBE (FORA)
                </th>
                <th width="15%">
                    PÚBLICO
                </th>
            </tr>
            @foreach (var item in lstpartidas)
            {
                var partidaanterior = new EmpreendaVc.Domain.Partida();
                if (divisao == 0 && mao == 2) {
                    partidaanterior = Model.FirstOrDefault(x => x.Mao == 1 && x.Rodada == item.Rodada && x.Clube1.Id == item.Clube2.Id && x.Clube2.Id == item.Clube1.Id);
                }
                <tr>
                    <td class="time1" width="30%">
                        @item.Clube1.Nome
                    </td>
                    <td class="time1gol" width="10%">
                        @if (mao == 2)
                        {
                            if (!string.IsNullOrEmpty(item.Penalti) && item.Vencedor.Id == item.Clube1.Id)
                            {
                            @: <a class="penalti" title="@item.Penalti">P</a> 
                            }    
                            
                            @: <span> (@partidaanterior.Gol2) </span>
                        }
                        
                        @item.Gol1
                    </td>
                    <td class="x" width="5%">
                        X
                    </td>
                    <td class="time2gol" width="10%">
                        @item.Gol2
                        @if (mao == 2)
                        {
                            @: <span> (@partidaanterior.Gol1) </span>
                            if (!string.IsNullOrEmpty(item.Penalti) && item.Vencedor.Id == item.Clube2.Id)
                            {
                            @: <a class="penalti" title="@item.Penalti">P</a>
                            }


                        }
                    </td>
                    <td class="time2" width="30%">
                        @item.Clube2.Nome
                    </td>
                    <td class="publico" width="15%">
                        @item.Publico.ToString("N0")
                    </td>
                </tr>
                <tr>
                    <td class="time1goln" colspan="2">
                        @foreach (var gol in item.Gols1)
                        {
                            @: @gol.Jogador.Nome @gol.Minuto'<br />
                                                }
                    </td>
                    <td class="x">
                    </td>
                    <td class="time2goln" colspan="2">
                        @foreach (var gol in item.Gols2)
                        {
                            @: @gol.Jogador.Nome @gol.Minuto'<br />
                                                }
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td class="quebra" colspan="2"></td>
                    <td class="quebra x"></td>
                    <td class="quebra" colspan="3"></td>
                </tr>
            }
        </table>
    }
    else
    {
        <p>
            Nenhum resultado disponível.</p>
    }
    @if (divisao > 0)
    {
        if (rodadanum > 1)
        { <a href="@Url.Action("Resultados", "Clube", new { divisao = divisao, rodada = rodadanum - 1 })" >Rodada
            anterior</a><text> -</text>  }
        if (rodadanum < 22)
        { <a href="@Url.Action("Resultados", "Clube", new { divisao = divisao, rodada = rodadanum + 1 })" >Próxima
            rodada</a> }
    }
    else
    {
        if (rodadanum < 16 || (rodadanum == 16 && mao == 2))
        { <a href="@Url.Action("Resultados", "Clube", new { taca = 1, rodada = mao == 1 ? (rodadanum * 2) : rodadanum, mao = mao == 1 ? 2 : 1 })" >Fase
            anterior</a><text> -</text>  }
        if (rodadanum > 1 || (rodadanum == 1 && mao == 1))
        { <a href="@Url.Action("Resultados", "Clube", new { taca = 1, rodada = mao == 1 ? rodadanum == 1 ? 1 : (rodadanum / 2) : rodadanum, mao = mao == 1 ? 2 : 1 })" >Próxima
            fase</a> }
    }
</div>
@{ Html.RenderAction("_Menu", "Clube"); }
